// ---- Traducciones ----

const translations = {
  es: {
    "meta.title": "KapakID – Identidad digital más segura que nunca",

    "header.brand": "KapakID",

    "nav.home": "Inicio",
    "nav.benefits": "Beneficios",
    "nav.success": "Casos de éxito",
    "nav.contact": "Contacto",

    "hero.kicker":
      "Plataforma de identidad digital para familias, estudiantes y profesionales.",
    "hero.title1": "Tu identidad digital",
    "hero.title2": "más segura que nunca",
    "hero.description":
      "KapakID centraliza tus credenciales, accesos y autorizaciones en un solo lugar, con seguridad de nivel empresarial y una experiencia simple para toda la familia.",
    "hero.primaryCta": "Empieza ahora",
    "hero.secondaryCta": "Ver cómo funciona",
    "hero.tag1": "+ Identidad segura",
    "hero.tag2": "– Estrés con contraseñas",
    "hero.stat1.value": "10k+",
    "hero.stat1.label": "Identidades protegidas",
    "hero.stat2.value": "99.9%",
    "hero.stat2.label": "Disponibilidad de la plataforma",
    "hero.stat3.value": "24/7",
    "hero.stat3.label": "Soporte disponible",

    "about.heading.prefix": "¿Por qué elegir",
    "about.heading.brand": "KapakID",
    "about.description":
      "Descubre cómo nuestra plataforma transforma la gestión de identidad digital con tecnología de vanguardia y una experiencia de usuario excepcional.",
    "about.card1.title": "Seguridad avanzada",
    "about.card1.text":
      "Cifrado de nivel empresarial, autenticación biométrica y control granular de permisos para cada miembro de la familia.",
    "about.card2.title": "Gestión centralizada",
    "about.card2.text":
      "Guarda documentos, credenciales y accesos críticos en una sola plataforma, con perfiles diferenciados para estudiantes, padres y profesionales.",
    "about.card3.title": "Implementación simple",
    "about.card3.text":
      "Onboarding guiado, plantillas listas para colegios, empresas y familias, y soporte humano cuando lo necesites.",

    "success.heading.prefix": "Lo que dicen nuestros",
    "success.heading.highlight": "clientes",
    "success.description":
      "Historias reales de familias, estudiantes y organizaciones que hoy gestionan su identidad digital con menos riesgo y más tranquilidad.",

    "contact.heading": "¿Listo para proteger tu identidad digital?",
    "contact.description":
      "Cuéntanos sobre tu familia, colegio o empresa y te ayudamos a diseñar el plan de identidad digital más seguro para tu contexto.",
    "contact.item1.title": "Integración sencilla",
    "contact.item1.text":
      "Compatibilidad con plataformas educativas, CRMs y apps de uso diario.",
    "contact.item2.title": "Soporte humano",
    "contact.item2.text":
      "Equipo especializado para acompañarte en la implementación.",
    "contact.item3.title": "Planes flexibles",
    "contact.item3.text":
      "Opciones para familias, instituciones educativas y negocios.",

    "contact.form.nameLabel": "Nombre completo",
    "contact.form.namePlaceholder": "Ingresa tu nombre",
    "contact.form.emailLabel": "Correo electrónico",
    "contact.form.emailPlaceholder": "tucorreo@ejemplo.com",
    "contact.form.typeLabel": "Tipo de organización",
    "contact.form.type.family": "Familia",
    "contact.form.type.school": "Colegio / Universidad",
    "contact.form.type.company": "Empresa",
    "contact.form.type.other": "Otro",
    "contact.form.messageLabel": "¿Qué necesitas?",
    "contact.form.messagePlaceholder": "Cuéntanos brevemente tu situación.",
    "contact.form.submit": "Solicitar demo",

    "footer.brand": "KapakID",
    "footer.description":
      "Revolucionamos la gestión de identidad digital con tecnología de vanguardia, accesible para familias, instituciones educativas y empresas.",
    "footer.column1.title": "Producto",
    "footer.column1.item1": "Características",
    "footer.column1.item2": "Casos de éxito",
    "footer.column1.item3": "Planes y precios",
    "footer.column2.title": "Compañía",
    "footer.column2.item1": "Acerca de",
    "footer.column2.item2": "Blog",
    "footer.column2.item3": "Soporte",
    "footer.column3.title": "Legal",
    "footer.column3.item1": "Términos de servicio",
    "footer.column3.item2": "Política de privacidad",
    "footer.column3.item3": "Cookies",
    "footer.copy": "© 2025 KapakID. Todos los derechos reservados."
  },

  en: {
    "meta.title": "KapakID – The safest way to manage your digital identity",

    "header.brand": "KapakID",

    "nav.home": "Home",
    "nav.benefits": "Benefits",
    "nav.success": "Success stories",
    "nav.contact": "Contact",

    "hero.kicker":
      "Digital identity platform for families, students and professionals.",
    "hero.title1": "Your digital identity",
    "hero.title2": "safer than ever",
    "hero.description":
      "KapakID centralizes your credentials, access and authorizations in one place, with enterprise-grade security and a simple experience for everyone.",
    "hero.primaryCta": "Get started",
    "hero.secondaryCta": "See how it works",
    "hero.tag1": "+ Safer identity",
    "hero.tag2": "– Password stress",
    "hero.stat1.value": "10k+",
    "hero.stat1.label": "Protected identities",
    "hero.stat2.value": "99.9%",
    "hero.stat2.label": "Platform uptime",
    "hero.stat3.value": "24/7",
    "hero.stat3.label": "Support available",

    "about.heading.prefix": "Why choose",
    "about.heading.brand": "KapakID",
    "about.description":
      "Discover how our platform transforms digital identity management with cutting-edge technology and an exceptional user experience.",
    "about.card1.title": "Advanced security",
    "about.card1.text":
      "Enterprise-grade encryption, biometric authentication and granular permissions for every family member.",
    "about.card2.title": "Centralized management",
    "about.card2.text":
      "Store documents, credentials and critical access in a single platform, with tailored profiles for students, parents and professionals.",
    "about.card3.title": "Simple rollout",
    "about.card3.text":
      "Guided onboarding, ready-to-use templates for schools, companies and families, plus human support when you need it.",

    "success.heading.prefix": "What our",
    "success.heading.highlight": "customers say",
    "success.description":
      "Real stories from families, students and organizations that manage their digital identity with less risk and more peace of mind.",

    "contact.heading": "Ready to protect your digital identity?",
    "contact.description":
      "Tell us about your family, school or company and we will help you design the safest digital identity plan for your context.",
    "contact.item1.title": "Easy integration",
    "contact.item1.text":
      "Compatible with educational platforms, CRMs and everyday apps.",
    "contact.item2.title": "Human support",
    "contact.item2.text":
      "A specialized team to guide you through implementation.",
    "contact.item3.title": "Flexible plans",
    "contact.item3.text":
      "Options for families, educational institutions and businesses.",

    "contact.form.nameLabel": "Full name",
    "contact.form.namePlaceholder": "Enter your name",
    "contact.form.emailLabel": "Email",
    "contact.form.emailPlaceholder": "you@email.com",
    "contact.form.typeLabel": "Organization type",
    "contact.form.type.family": "Family",
    "contact.form.type.school": "School / University",
    "contact.form.type.company": "Company",
    "contact.form.type.other": "Other",
    "contact.form.messageLabel": "What do you need?",
    "contact.form.messagePlaceholder": "Briefly describe your situation.",
    "contact.form.submit": "Request demo",

    "footer.brand": "KapakID",
    "footer.description":
      "We reinvent digital identity management with cutting-edge technology, accessible to families, schools and businesses.",
    "footer.column1.title": "Product",
    "footer.column1.item1": "Features",
    "footer.column1.item2": "Success stories",
    "footer.column1.item3": "Plans & pricing",
    "footer.column2.title": "Company",
    "footer.column2.item1": "About",
    "footer.column2.item2": "Blog",
    "footer.column2.item3": "Support",
    "footer.column3.title": "Legal",
    "footer.column3.item1": "Terms of service",
    "footer.column3.item2": "Privacy policy",
    "footer.column3.item3": "Cookies",
    "footer.copy": "© 2025 KapakID. All rights reserved."
  }
};

let currentLang = "es";

// ---- Datos de reseñas (ES / EN) ----

const reviewsData = [
  {
    id: 1,
    initials: "AG",
    reviewer: { es: "Ana Gómez", en: "Ana Gómez" },
    role: { es: "Madre de familia", en: "Parent" },
    rating: 5,
    description: {
      es: "KapakID nos ayudó a centralizar los accesos de toda la familia. Ahora mis hijos pueden iniciar sesión en el colegio y en sus plataformas favoritas sin compartir contraseñas inseguras.",
      en: "KapakID helped us centralize our family's access. My kids can now log into school and their favorite platforms without sharing insecure passwords."
    }
  },
  {
    id: 2,
    initials: "CM",
    reviewer: { es: "Carlos Mejía", en: "Carlos Mejía" },
    role: { es: "Coordinador TI en colegio", en: "IT coordinator at school" },
    rating: 4,
    description: {
      es: "La implementación fue rápida y el equipo de soporte nos acompañó en todo momento. Los estudiantes olvidan menos claves y los padres están más tranquilos.",
      en: "Implementation was quick and the support team guided us all the way. Students forget fewer passwords and parents feel more confident."
    }
  },
  {
    id: 3,
    initials: "JE",
    reviewer: { es: "José Espinoza", en: "José Espinoza" },
    role: { es: "Independiente", en: "Freelancer" },
    rating: 5,
    description: {
      es: "Como profesional independiente necesitaba separar mis accesos personales y de trabajo. KapakID me dio una forma clara y segura de hacerlo.",
      en: "As a freelancer I needed to separate personal and work access. KapakID gave me a clear and secure way to do it."
    }
  },
  {
    id: 4,
    initials: "RR",
    reviewer: { es: "Rosa Rivas", en: "Rosa Rivas" },
    role: { es: "Directora de primaria", en: "Elementary school principal" },
    rating: 5,
    description: {
      es: "El panel para la institución es muy intuitivo. Podemos dar acceso temporal a proveedores o invitados sin exponer las cuentas principales.",
      en: "The institutional dashboard is very intuitive. We can give temporary access to vendors or guests without exposing main accounts."
    }
  },
  {
    id: 5,
    initials: "AM",
    reviewer: { es: "Alberto Medina", en: "Alberto Medina" },
    role: { es: "Padre y emprendedor", en: "Parent & entrepreneur" },
    rating: 4,
    description: {
      es: "Lo que más valoro es poder enseñar a mis hijos buenas prácticas de seguridad desde pequeños, usando una herramienta que también me sirve para mi negocio.",
      en: "What I value most is teaching my kids good security habits from an early age, using a tool that also works for my business."
    }
  }
];

let reviewsPageIndex = 0;
const reviewsPageSize = 3;

// ---- Funciones de internacionalización ----

function applyLanguage(lang) {
  const dict = translations[lang];
  if (!dict) return;

  currentLang = lang;

  // Actualizar atributo lang del <html>
  document.documentElement.lang = lang;

  // Título de la pestaña
  if (dict["meta.title"]) {
    document.title = dict["meta.title"];
  }

  // Elementos con data-i18n (texto interno)
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const text = dict[key];
    if (typeof text === "string") {
      el.textContent = text;
    }
  });

  // Placeholders
  document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
    const key = el.getAttribute("data-i18n-placeholder");
    const text = dict[key];
    if (typeof text === "string") {
      el.placeholder = text;
    }
  });

  // Opciones de select (texto interno)
  const select = document.getElementById("type");
  if (select) {
    Array.from(select.options).forEach((opt) => {
      const key = opt.getAttribute("data-i18n");
      if (key && dict[key]) {
        opt.textContent = dict[key];
      }
    });
  }

  // Botones de idioma activos
  document.querySelectorAll(".lang-switch").forEach((btn) => {
    const buttonLang = btn.getAttribute("data-lang");
    if (buttonLang === lang) {
      btn.classList.add("active");
    } else {
      btn.classList.remove("active");
    }
  });

  // Volver a renderizar reseñas con el nuevo idioma
  renderReviews();
}

// ---- Carrusel de reseñas ----

function getTotalReviewPages() {
  return Math.ceil(reviewsData.length / reviewsPageSize);
}

function getVisibleReviews(pageIndex) {
  const start = pageIndex * reviewsPageSize;
  const end = start + reviewsPageSize;
  return reviewsData.slice(start, end);
}

function renderReviews() {
  const container = document.getElementById("reviews-container");
  const indicator = document.getElementById("reviews-page-indicator");
  if (!container) return;

  container.innerHTML = "";

  const totalPages = getTotalReviewPages();
  if (reviewsPageIndex >= totalPages) {
    reviewsPageIndex = 0;
  }

  const visibleReviews = getVisibleReviews(reviewsPageIndex);
  visibleReviews.forEach((review) => {
    const card = document.createElement("article");
    card.className = "review-card";

    const quoteIcon = document.createElement("div");
    quoteIcon.className = "review-quote-icon";
    quoteIcon.innerHTML = `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
        <path d="M7.17 6A3.17 3.17 0 0 0 4 9.17v5.66A3.17 3.17 0 0 0 7.17 18H8a2 2 0 0 0 2-2v-5.83A4.17 4.17 0 0 0 5.83 6z"></path>
        <path d="M16.17 6A3.17 3.17 0 0 0 13 9.17v5.66A3.17 3.17 0 0 0 16.17 18H17a2 2 0 0 0 2-2v-5.83A4.17 4.17 0 0 0 14.83 6z"></path>
      </svg>
    `;

    const text = document.createElement("p");
    text.className = "review-text";
    text.textContent = review.description[currentLang] || review.description.es;

    const meta = document.createElement("div");
    meta.className = "review-meta";

    const person = document.createElement("div");
    person.className = "review-person";

    const avatar = document.createElement("div");
    avatar.className = "review-avatar";
    avatar.textContent = review.initials;

    const personInfo = document.createElement("div");
    const nameEl = document.createElement("div");
    nameEl.className = "review-name";
    nameEl.textContent = review.reviewer[currentLang] || review.reviewer.es;

    const roleEl = document.createElement("div");
    roleEl.className = "review-role";
    roleEl.textContent = review.role[currentLang] || review.role.es;

    personInfo.appendChild(nameEl);
    personInfo.appendChild(roleEl);

    person.appendChild(avatar);
    person.appendChild(personInfo);

    const rating = document.createElement("div");
    rating.className = "review-rating";
    rating.textContent = "★".repeat(review.rating);

    meta.appendChild(person);
    meta.appendChild(rating);

    card.appendChild(quoteIcon);
    card.appendChild(text);
    card.appendChild(meta);

    container.appendChild(card);
  });

  if (indicator) {
    indicator.textContent = `${reviewsPageIndex + 1} / ${getTotalReviewPages()}`;
  }
}

// ---- Menú móvil ----

function setupMobileMenu() {
  const toggle = document.getElementById("mobile-menu-button");
  const nav = document.getElementById("nav-menu");

  if (!toggle || !nav) return;

  toggle.addEventListener("click", () => {
    nav.classList.toggle("open");
  });

  // Cerrar menú al hacer click en un enlace
  nav.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => {
      nav.classList.remove("open");
    });
  });
}

// ---- Listeners de idioma ----

function setupLanguageSwitch() {
  document.querySelectorAll(".lang-switch").forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.getAttribute("data-lang");
      applyLanguage(lang);
    });
  });
}

// ---- Listeners de carrusel ----

function setupReviewsControls() {
  const prevBtn = document.getElementById("prev-reviews");
  const nextBtn = document.getElementById("next-reviews");

  if (prevBtn) {
    prevBtn.addEventListener("click", () => {
      const totalPages = getTotalReviewPages();
      reviewsPageIndex = (reviewsPageIndex - 1 + totalPages) % totalPages;
      renderReviews();
    });
  }

  if (nextBtn) {
    nextBtn.addEventListener("click", () => {
      const totalPages = getTotalReviewPages();
      reviewsPageIndex = (reviewsPageIndex + 1) % totalPages;
      renderReviews();
    });
  }
}

// ---- Init ----

document.addEventListener("DOMContentLoaded", () => {
  setupMobileMenu();
  setupLanguageSwitch();
  setupReviewsControls();
  applyLanguage(currentLang); // También renderiza las reseñas
});
